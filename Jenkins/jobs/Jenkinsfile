import groovy.json.JsonSlurperClassic

def jsonParse(def json){
    new groovy.json.JsonSlurperClassic().parseText(json)
}

pipeline {

    agent any
    stages {
        stage('SSH a servidor') {
            steps {
                withCredentials([sshUserPrivateKey(credentialsId: 'PruebaGit', keyFileVariable: 'SSH_KEY', usernameVariable: 'SSH_USER')]) {
                    sh '''
                        ssh -i $SSH_KEY -o StrictHostKeyChecking=no $SSH_USER@64.23.151.32 "ls"
                    '''
                }
            }
        }
    }

    post {
        always {
            deleteDir() // limpia workspace en B
            sh "echo 'Fase Always'"
        }
        success {
            sh "echo 'Fase Success'"
        }
        failure {
            sh "echo 'Fase Failure'"
        }
    }
}
